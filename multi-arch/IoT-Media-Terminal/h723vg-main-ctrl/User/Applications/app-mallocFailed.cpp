/**
*******************************************************************************
 * @file    app-stackOverflow.cpp
 * @brief   简要描述
 *******************************************************************************
 * @attention
 *
 * none
 *
 *******************************************************************************
 * @note
 *
 * none
 *
 *******************************************************************************
 * @author  MekLi
 * @date    2025/8/24
 * @version 1.0
 *******************************************************************************
 */


/* ------- define --------------------------------------------------------------------------------------------------*/


/* ------- include ---------------------------------------------------------------------------------------------------*/

#include <cstring>

#include "FreeRTOS.h"
#include "stm32h7xx_hal.h"
#include "stm32h7xx_hal_uart.h"
#include "task.h"
#include "usart.h"

#include <cstdio>




/* ------- class prototypes-----------------------------------------------------------------------------------------*/

extern "C" {
    void vApplicationMallocFailedHook();
}


/* ------- macro -----------------------------------------------------------------------------------------------------*/


/* ------- variables -------------------------------------------------------------------------------------------------*/


/* ------- function implement ----------------------------------------------------------------------------------------*/

void vApplicationMallocFailedHook() {

    uint32_t free = xPortGetFreeHeapSize();
    uint32_t minfree = xPortGetMinimumEverFreeHeapSize();
    char msg[] = "Free: %u, MinFree: %u\n";

    sprintf(msg, "Free: %d, MinFree: %d\n", free, minfree);
    HAL_UART_Transmit(&huart1, (uint8_t*)msg, sizeof(msg), 0xFFFF);

    while (true)
        ;
}
